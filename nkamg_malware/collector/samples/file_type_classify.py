#!/usr/bin/env python
# -*- coding: utf-8 -*-

#Nankai University Information Security
#QiuKF 1055419050@qq.com
#classify file types into big class
import re
ret={}
DOS_file=[]
PE_file=[]
Linux_exe_file=[]
Android_file=[]
Microsoft_Office_file=[]
MAC_file=[]
HTML_file=[]
Script_file=[]
Media_file=[]
Image_file=[]
Document_file=[]
Compressed_file=[]
Other_file=[]
Mail_file=[]
PDF_file=[]

static_column=[
'DOS file',
'Windows PE file',
'Linux executable file',
'Android file',
'Microsoft Office file',
'MAC file',
'HTML file',
'Script file',
'Media file',
'Image file',
'Document file',
'Compressed file',
'Other file',
'Mail file',
'PDF file'
]

#need change
input_file='input.csv'


def get_data(input_file):
    ret={}

    input=open('input.csv','r')
    temp=input.read().split('\n')[1:][:-1]
    #print temp
    for each in temp:
        #print each
        temp_save=each.split(',')
        key=''
        for each in temp_save[:-1]:
            key+=each
        count=temp_save[-1]
        ret[key]=int(count)
    #print ret
    return ret


def count(data_dic):
    ret={}
 
    test=data_dic
    for each in static_column:
        ret[each]=0

    #print column_set
    for each in data_dic:
        each_low=each.lower()
        if 'PDF' in each:
            ret['PDF file']+=data_dic[each]
            PDF_file.append(each+','+str(data_dic[each]))
            continue
        if 'mail' in each_low or 'mime' in each_low or 'smtp' in each_low:
            ret['Mail file']+=data_dic[each]
            Mail_file.append(each+','+str(data_dic[each]))
            continue
        if 'image' in each_low or 'icon' in each_low :
            ret['Image file']+=data_dic[each]
            Image_file.append(each+' ,'+str(data_dic[each]))
            continue
        if 'DOS' in each:
            ret['DOS file']+=data_dic[each]
            DOS_file.append(each+' ,'+str(data_dic[each]))
            continue
        if 'PE' in each or ('windows' in each_low and 'executable' in each_low):
            ret['Windows PE file']+=data_dic[each]
            PE_file.append(each+' ,'+str(data_dic[each]))
            continue

        if 'ELF'in each or 'COFF' in each or ('executable' in each and 'linux' in each_low) or '.o ' in each:
            ret['Linux executable file']+=data_dic[each]
            Linux_exe_file.append(each+' ,'+str(data_dic[each]))
            continue

        if 'android' in each_low or 'dex ' in each_low:
            ret['Android file']+=data_dic[each]
            Android_file.append(each+' ,'+str(data_dic[each]))
            continue

        if 'Excel' in each or 'Word' in each or 'Access' in each or 'PowerPoint' in each:
            ret['Microsoft Office file']+=data_dic[each]
            Microsoft_Office_file.append(each+' ,'+str(data_dic[each]))
            continue

        if 'apple' in each_low :
            ret['MAC file']+=data_dic[each]
            MAC_file.append(each+' ,'+str(data_dic[each]))
            continue

        if 'html ' in each_low:
            ret['HTML file']+=data_dic[each]
            HTML_file.append(each+' ,'+str(data_dic[each]))
            continue

        if 'script' in each_low:
            ret['Script file']+=data_dic[each]
            Script_file.append(each+' ,'+str(data_dic[each]))
            continue

        if 'media' in each_low  or 'audio' in each_low or 'mpeg' in each_low or 'song' in each_low:
            ret['Media file']+=data_dic[each]
            Media_file.append(each+' ,'+str(data_dic[each]))
            continue


        if 'archive' in each_low :
            ret['Compressed file']+=data_dic[each]
            Compressed_file.append(each+' ,'+str(data_dic[each]))
            continue
        if 'tex' in each_low or 'XML' in each or 'Windows' in each or 'text' in each or 'source' in each:
        	ret['Document file']+=data_dic[each]
        	Document_file.append(each+' ,'+str(data_dic[each]))
        	continue
        ret['Other file']+=data_dic[each]
        Other_file.append(each+' ,'+str(data_dic[each]))
        print each+' ,'+str(data_dic[each])
    #print DOS_file
    detail=open('class_new.csv','w')

    #detail.write('DOS file , Total:'+str(ret['DOS file'])+'\n')
    for each in DOS_file:
        detail.write(each+',DOS file\n')
    detail.write('\n')

    #detail.write('Windows PE file , Total:'+str(ret['Windows PE file'])+'\n')
    for each in PE_file:
        detail.write(each+',Windows PE file\n')
    detail.write('\n')

    #detail.write('Linux executable file , Total:'+str(ret['Linux executable file'])+'\n')
    for each in Linux_exe_file:
        detail.write(each+',Linux executable file\n')
    detail.write('\n')

    #detail.write('Android file , Total:'+str(ret['Android file'])+'\n')
    for each in Android_file:
         detail.write(each+',Android file\n')
    detail.write('\n')

    #detail.write('Microsoft Office file , Total:'+str(ret['Microsoft Office file'])+'\n')
    for each in Microsoft_Office_file:
        detail.write(each+',Microsoft Office file\n')
    detail.write('\n')

    #detail.write('MAC file , Total:'+str(ret['MAC file'])+'\n')
    for each in MAC_file:
        detail.write(each+',MAC file\n')
    detail.write('\n')

    #detail.write('HTML file , Total:'+str(ret['HTML file'])+'\n')
    for each in HTML_file:
        detail.write(each+',HTML file\n')
    detail.write('\n')

    #detail.write('Script file , Total:'+str(ret['Script file'])+'\n')
    for each in Script_file:
        detail.write(each+',Script file\n')
    detail.write('\n')

    #detail.write('Media file , Total:'+str(ret['Media file'])+'\n')
    for each in Media_file:
        detail.write(each+',Media file\n')
    detail.write('\n')

    #detail.write('Image file , Total:'+str(ret['Image file'])+'\n')
    for each in Image_file:
        detail.write(each+',Image file\n')
    detail.write('\n')

    #detail.write('Document file , Total:'+str(ret['Document file'])+'\n')
    for each in Document_file:
        detail.write(each+',Document file\n')
    detail.write('\n')

    #detail.write('Compressed file , Total:'+str(ret['Compressed file'])+'\n')
    for each in Compressed_file:
        detail.write(each+',Compressed file\n')
    detail.write('\n')

    #detail.write('Other file:'+str(ret['Other file'])+'\n')
    for each in Other_file:
        detail.write(each+',Other file\n')
    detail.write('\n')

    #detail.write('Mail file:'+str(ret['Mail file'])+'\n')
    for each in Mail_file:
        detail.write(each+',Mail file\n')
    detail.write('\n')

    #detail.write('PDF file:'+str(ret['PDF file'])+'\n')
    for each in PDF_file:
        detail.write(each+',PDF file\n')
    detail.write('\n')

    return ret
    

def test(dic):
    count=0
    for each in dic:
        count+=dic[each]
    print 'count',count

def save_csv(dic):
    save=open('output.csv','w')
    
    for each in dic:
        save.write(each+','+str(dic[each])+'\n')

    save.close()

def main():
    data=get_data(input_file)
    ret=count(data)
    save_csv(ret)
    #print ret
   
if __name__=='__main__':
    main()
    

